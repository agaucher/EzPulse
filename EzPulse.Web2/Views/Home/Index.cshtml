<div class="wrapper">
    <div id="wizard" class="wizard">
        <div class="wizard__content">
            <header class="wizard__header">
                <div class="wizard__header-overlay"></div>

                <div class="wizard__header-content">
                    <h1 class="wizard__title">EzPulse</h1>
                    <p class="wizard__subheading">Accelerate and Standardize IMPULSE insertions.</p>
                </div>

                <div class="wizard__steps">
                    <nav class="steps">
                        <div class="step">
                            <div class="step__content">
                                <p class="step__number"><i class="fa fa-github-alt"></i></p>
                                <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                                    <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none" />
                                    <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8" />
                                </svg>

                                <div class="lines">
                                    <div class="line -start">
                                    </div>

                                    <div class="line -background">
                                    </div>

                                    <div class="line -progress">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="step">
                            <div class="step__content">
                                <p class="step__number"><i class="fa fa-book"></i></p>
                                <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                                    <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none" />
                                    <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8" />
                                </svg>

                                <div class="lines">
                                    <div class="line -background">
                                    </div>

                                    <div class="line -progress">
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="step">
                            <div class="step__content">
                                <p class="step__number"><i class="fa fa-group"></i></p>
                                <svg class="checkmark" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 52 52">
                                    <circle class="checkmark__circle" cx="26" cy="26" r="25" fill="none" />
                                    <path class="checkmark__check" fill="none" d="M14.1 27.2l7.1 7.2 16.7-16.8" />
                                </svg>

                                <div class="lines">
                                    <div class="line -background">
                                    </div>

                                    <div class="line -progress">
                                    </div>
                                </div>
                            </div>
                        </div>
                    </nav>
                </div>
            </header>

            <form id="formular" action="http://www.test.bg">

                <div class="panels">
                    <div class="panel">
                        <header class="panel__header">
                            <h2 class="panel__title">New Release</h2>
                            <p class="panel__subheading">Prepare your changelog and insert the related Change in Impulse</p>
                        </header>

                        <p class="panel__content">

                            <div class="form-group">
                                <label for="inputApplication">Your Application</label>
                                <select id="inputApplication" class="form-control">
                                    <option selected></option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="inputProfile">Your Profile</label>
                                <select id="inputProfile" class="form-control">
                                    <option selected></option>
                                </select>
                            </div>

                            <div class="form-group">
                                <label for="inputReleaseVersion">Release Version</label>
                                <input type="text" class="form-control" id="inputReleaseVersion" placeholder="2.2.1">
                            </div>

                        </p>

                        <p class="panel__content">Click the 'Next' button to retrieve the ChangeLog from Jira</p>

                    </div>

                    <div class="panel">

                        <header class="panel__header">
                            <h2 class="panel__title">Your Release:</h2>
                            <p class="panel__subheading">Application: <span id="labelApplication"></span></p>
                            <p class="panel__subheading">Version: <span id="labelVersion"></span></p>
                        </header>

                        <div>
                            <a href="fdfdd">
                                <img class="pull-right" style="height:47px;width:43px;margin-top:-25px" src="@Url.Content("~/Content/Images/icon_excel.png")" alt="Excel Icon" />
                            </a>
                        </div>


                        <div class="form-group">
                            <label for="labelChangeLog">Change Log:</label>
                            <textarea class="form-control" style="resize: none;" id="changeLog" rows="8"></textarea>
                        </div>

                        <p class="panel__content">You can modify the change log as you wish, the excel file will be automatically updated to take into account your last changes. Go to the next step to fill in the fields for the Change</p>

                    </div>

                    <div class="panel">
                        <header class="panel__header">
                            <h2 class="panel__title">Your Impulse Ticket</h2>
                            <p class="panel__subheading">This is the last step before ticket creation.</p>
                        </header>

                        <p class="panel__content">

                            <div class="form-group">
                                <label for="inputSummary">Summary</label>
                                <input type="text" id="inputSummary" class="form-control" placeholder="Your summary here">
                            </div>

                            <div class="form-group">
                                <label for="inputAssignee">Assignee:</label>
                                <select id="inputAssignee" class="form-control">
                                    <option selected></option>
                                </select>
                            </div>

                            <div class="row">
                                <div class="col-xs-6">
                                    <div class="form-group">
                                        <label for="releaseStartDate">Start Date:</label>
                                        <div id='releaseStartDate' class='input-group date'>
                                            <input type='text' class="form-control" />
                                            <span class="input-group-addon">
                                                <span class="glyphicon glyphicon-calendar"></span>
                                            </span>
                                        </div>
                                    </div>
                                </div>

                                <div class="col-xs-6">
                                    <div class="form-group">
                                        <label for="releaseEndDate">End Date:</label>
                                        <div id='releaseEndDate' class='input-group date'>
                                            <input type='text' class="form-control" />
                                            <span class="input-group-addon">
                                                <span class="glyphicon glyphicon-calendar"></span>
                                            </span>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </p>
                    </div>
                </div>

            </form>

            <div class="wizard__footer">
                <button class="button previous" id="buttonPrevious">Previous</button>
                <button class="button next" id="buttonNext">Next</button>
            </div>

        </div>

        <h1 class="wizard__final-message">
            Congratulations, your Change has been created into IMPULSE:
        </h1>
    </div>
</div>

@section Scripts {
    <script type="text/javascript">

        // update combobox
        function fetchData(urlDataSource, callback) {
            // Call Web API to get data and refresh combobox
            $.ajax({
                url: urlDataSource,
                type: 'GET',
                dataType: 'json',
                success: function (data) { callback(data); },
                error: function (request, message, error) {
                    displayErrorMessage(request, message, error);
                }
            });
        }

        function displayErrorMessage(request, message, error) {
            var msg = "";
            msg += "Code: " + request.status + "\n";
            msg += "Text: " + request.statusText + "\n";
            if (request.responseJSON != null) {
                msg += "Message" +
                    request.responseJSON.Message + "\n";
            }
            alert(msg);
        }

        function refreshCombobox(comboboxId, urlDataSource) {
            fetchData(urlDataSource, function (data) {
                $(comboboxId + ' option').remove();
                if (data.length > 0) {
                    var selected = 'selected';
                    $.each(data, function (index, value) {
                        $(comboboxId).append('<option value="' + value + '" ' + selected + '>' + value + '</option>');
                        selected = '';
                    });
                    $(comboboxId).trigger('change');
                }
            });
        }

        function refreshLabelRelease() {
            var application = $('#inputApplication').val();
            var releaseVersion = $('#inputReleaseVersion').val();

            $("#labelRelease").html('Your ' + application + ' Release: ' + releaseVersion);
        }

        function refreshChangeLog(changelog, urlDataSource) {
            var application = $('#inputApplication').val();
            var releaseVersion = $('#inputReleaseVersion').val();

            fetchData(urlDataSource, function (data) {
                $("#changeLog").val(data.join('\n'));
            });
        }


        $(function () {

            $('#inputApplication').change(function () {
                var application = $('#inputApplication').val();
                $("#labelApplication").html(application);
                refreshCombobox('#inputProfile', '/api/profiles/' + application);
                $("#inputSummary").val("[" + application + "] Release Scheduled");
            });

            $('#inputReleaseVersion').on("change paste keyup", function () {
                var application = $('#inputApplication').val();
                var version = $('#inputReleaseVersion').val();
                $("#labelVersion").html(version);
                $("#inputSummary").val("[" + application + "] Release " + version);
            });

            $('#buttonNext').on("click", function () {
                var step = wizard.currentStep;
                var changeLog = $('#changeLog').val();
                if (step == 1 && changeLog.length == 0) {
                    // after first step valisation
                    refreshChangeLog('#changeLog', '/api/changelog');
                }
                if (step == 3) {
                    // submit formular
                    var formData = $("#formular").serialize();
                    $.ajax({
                        type: 'POST',
                        url: $("#formular").attr('action'),
                        data: formData,
                        success: function (data) {
                            alert('ok');
                        },
                        error: function (request, message, error) {
                            displayErrorMessage(request, message, error);
                        }
                    });
                }
            });

            var today = new Date();
            $('#releaseStartDate input').val(today.getFullYear() + '/' + today.getMonth() + '/' + today.getDate() + ' 18:00:00');
            $('#releaseStartDate input').datetimepicker({
                //formatDate: "Y/m/d"
            });

            $('#releaseEndDate input').val(today.getFullYear() + '/' + today.getMonth() + '/' + today.getDate() + ' 18:30:00');
            $('#releaseEndDate input').datetimepicker({
                //dateFormat: "d/m/Y"
            });

            refreshCombobox('#inputApplication', '/api/applications');


        });
    </script>
}
